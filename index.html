<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  center
  {
    display: grid;
    grid: auto / 1fr 1fr 1fr;
    grid-gap: .5em;
  }
  input{width:100%}
  .c2{grid-column: span 2}
</style>
<center id="main">
  <a>Year</a>
  <a>Make</a>
  <a>Model</a>
  <input id="year" type="number">
  <input id="make">
  <input id="model">
  <a class="c2">VIN</a>
  <a>ZIP</a>
  <input id="vin" class="c2">
  <input id="zip" type="number">
  <button id="decode">VIN Decode</button>
  <button id="nada">NADA</button>
  <button id="kbb">KBB</button>
  <button id="decodeThis">Decode This</button>
  <button id="nam">North American Motoring</button>
  <button id="autotrader">AutoTrader</button>
  <button id="dealer">Find Dealer</button>
  <button id="parts">Parts</button>
  <button id="tax">Tax Rate</button>
</center>
<div id="partsList"></div>
<footer><small>*VIN decoder provided by https://vpic.nhtsa.dot.gov</small></footer>
<script type="module">
import * as z from 'https://cdn.rawgit.com/zerowolfcode/zlib/4cd52327/zt.js';
import * as parts from 'https://zwc0.github.io/cars/parts.js';
//onchange for inputs to set variables
var inputs={};
z.each('input',e=>{
  inputs[e.id]='';
  e.addEventListener('change',e=>inputs[e.target.id]=e.target.value.toLowerCase());
});
//buttons
z.z('#decode',0).onclick=()=>{
  fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvalues/${inputs.vin}?format=json`)
  .then(e=>e.json())
  .then(e=>{
    e=e.Results[0];
    z.v('#year',e.ModelYear);
    z.v('#make',e.Make);
    z.v('#model',e.Model);
    //trigger change event
    let evt = new CustomEvent('change');
    z.z('#year')[0].dispatchEvent(evt);
    z.z('#make')[0].dispatchEvent(evt);
    z.z('#model')[0].dispatchEvent(evt);
  }).catch(e=>alert(e));
  return false;
};
z.z('#nada',0).onclick=()=>window.open(`https://www.nadaguides.com/Cars/${inputs.year}/${inputs.make}/${inputs.model}`);
z.z('#kbb',0).onclick=()=>window.open(`https://www.kbb.com/${inputs.make}/${inputs.model}/${inputs.year}/styles/?intent=buy-used&pricetype=retail`);
z.z('#decodeThis',0).onclick=()=>window.open(`https://www.decodethis.com/vin/${inputs.vin}`);
z.z('#nam',0).onclick=()=>window.open(`https://www.northamericanmotoring.com/forums/vindecoder.php?vin=${inputs.vin}`);
z.z('#autotrader',0).onclick=()=>window.open(`https://www.autotrader.com/cars-for-sale/${inputs.year}/${inputs.make}/${inputs.model}/?zip=${inputs.zip}`);
z.z('#dealer',0).onclick=()=>window.open(`https://www.google.com/search?q=${inputs.make} dealer`);

var listParts=(p)=>{
  //back
  let center = z.c('center');
  let button = z.c('button');
  button.textContent='Back';
  button.onclick=()=>{z.s('#main');z.h('#partsList');center.remove();return false};
  z.a(center,button);
  //generic options
  for ( var i in parts.generic ){
    let g=parts.generic[i];
    button = z.c('button');
    button.textContent = i;
    button.onclick=()=>window.open(`https://${g.includes("${") ? eval(g) : g}`);
    z.a(center,button);
  }
  //display other options
  for ( var i in p ){
    button = z.c('button');
    button.textContent = i;
    button.onclick=()=>window.open(`https://${p[i]}`);
    z.a(center,button);
  }
  //attach elements and show list
  z.a('#partsList',center);
  z.h('#main');
  z.s('#partsList');
};
z.z('#parts',0).onclick=()=>listParts(parts[inputs.make]);
z.z('#tax',0).onclick=()=>window.open(`http://www.sale-tax.com/${inputs.zip}`);
if(window.location.search){
  z.v('#vin',window.location.search.slice(1));
  z.z('#decode',0).click();
};
</script>
